<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Noticias - Instituto T√©cnico Industrial Manuel Elkin Patarroyo</title>
  <link rel="stylesheet" href="../style.css">
  <link rel="icon" type="image/jpeg" href="../src/logo.jpeg">
  <script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
  <style>


    .news-detail {
      max-width: 800px;
      margin: 0 auto;
      padding: 30px 20px;
    }
    
    .news-detail img {
      width: 100%;
      max-height: 400px;
      object-fit: cover;
      border-radius: 12px;
      margin-bottom: 20px;
    }
    
    .news-meta {
      display: flex;
      gap: 20px;
      color: #666;
      margin-bottom: 20px;
      font-size: 14px;
    }
    
    .news-content {
      line-height: 1.8;
      font-size: 16px;
      color: #333;
    }
    
    .back-button {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: #003366;
      font-weight: 600;
      margin-bottom: 20px;
      transition: transform 0.3s ease;
    }
    
    .back-button:hover {
      transform: translateX(-5px);
    }
    
    .filter-section {
      background: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 30px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .search-box {
      width: 100%;
      padding: 12px 20px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s ease;
    }
    
    .search-box:focus {
      outline: none;
      border-color: #003366;
    }
    
    .no-results {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }
    
    .pagination {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 40px;
    }
    
    .pagination button {
      padding: 10px 20px;
      border: 2px solid #003366;
      background: white;
      color: #003366;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .pagination button:hover:not(:disabled) {
      background: #003366;
      color: white;
    }
    
    .pagination button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .pagination .active {
      background: #003366;
      color: white;
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header class="header">
    <div class="container header-container">
      <div class="logo">
        <img src="../src/logo.jpeg" alt="Logo del Instituto">
        <h1>Instituto T√©cnico Industrial Manuel Elkin Patarroyo</h1>
      </div>

      <nav class="nav" aria-label="Navegaci√≥n principal">
        <a href="../index.html">Inicio</a>
        <a href="sobrenosotros.html">Instituci√≥n</a>
        <a href="noticias.html">Noticias</a>
        <a href="academico.html">Acad√©mico</a>
        <a href="galeria.html">Galer√≠a</a>
        <a href="contactanos.html">Contacto</a>
      </nav>

      <button id="menu-btn" class="menu-btn" aria-label="Abrir men√∫ de navegaci√≥n" aria-expanded="false">
        <box-icon name='menu' color='white'></box-icon>
      </button>
    </div>

    <nav id="mobile-menu" class="mobile-menu" aria-label="Navegaci√≥n m√≥vil">
      <a href="../index.html">Inicio</a>
      <a href="sobrenosotros.html">Instituci√≥n</a>
      <a href="noticias.html">Noticias</a>
      <a href="academico.html">Acad√©mico</a>
      <a href="galeria.html">Galer√≠a</a>
      <a href="contactanos.html">Contacto</a>
    </nav>
  </header>

  <!-- CONTENIDO PRINCIPAL -->
  <section class="section">
    <div class="container">
      <h2 class="section-title">üì∞ Noticias y Eventos</h2>
      
      <!-- Filtro de b√∫squeda -->
      <div class="filter-section">
        <input 
          type="text" 
          id="searchBox" 
          class="search-box" 
          placeholder="üîç Buscar noticias..."
        >
      </div>

      <!-- Loading -->
      <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Cargando noticias...</p>
      </div>

      <!-- Lista de noticias -->
      <div id="newsList" class="news-grid"></div>

      <!-- Sin resultados -->
      <div id="noResults" class="no-results hidden">
        <h3>üòï No se encontraron noticias</h3>
        <p>Intenta con otros t√©rminos de b√∫squeda</p>
      </div>

      <!-- Paginaci√≥n -->
      <div id="pagination" class="pagination hidden"></div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="container">
      <p>&copy; 2025 Instituto T√©cnico Industrial Manuel Elkin Patarroyo. Todos los derechos reservados.</p>
      <div class="social-links">
        <a href="#" aria-label="Facebook"><box-icon name='facebook' type='logo' color='white'></box-icon></a>
        <a href="#" aria-label="Instagram"><box-icon name='instagram' type='logo' color='white'></box-icon></a>
        <a href="#" aria-label="YouTube"><box-icon name='youtube' type='logo' color='white'></box-icon></a>
      </div>
    </div>
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
  // tu c√≥digo aqu√≠
  
  
  
  const API_URL = 'http://localhost:3000/api';
  let allNews = [];
  let filteredNews = [];
  const itemsPerPage = 9;
  let currentPage = 1;
  
  // Men√∫ m√≥vil
  const menuBtn = document.getElementById('menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  
  menuBtn.addEventListener('click', () => {
    const isOpen = mobileMenu.classList.toggle('active');
    menuBtn.setAttribute('aria-expanded', isOpen);
    const icon = menuBtn.querySelector('box-icon');
    icon.setAttribute('name', isOpen ? 'x' : 'menu');
  });
  
  // Cargar noticias
  async function loadNews() {
    const loading = document.getElementById('loading');
    const newsList = document.getElementById('newsList');
    
    try {
      console.log('üì∞ Cargando noticias desde:', `${API_URL}/news`);
      const response = await fetch(`${API_URL}/news`);
      
      console.log('üì• Respuesta:', response.status);
      
      if (!response.ok) throw new Error('Error al cargar noticias');
      
      allNews = await response.json();
      console.log('üìä Total noticias:', allNews.length);
      console.log('üìã Datos:', allNews);
      
      filteredNews = allNews;
      
      loading.classList.add('hidden');
      displayNews();
    } catch (error) {
      console.error('‚ùå Error:', error);
      loading.innerHTML = '<p class="error-message">Error al cargar las noticias. Por favor, intenta m√°s tarde.</p>';
    }
  }
  
  // Mostrar noticias
  function displayNews() {
    const newsList = document.getElementById('newsList');
    const noResults = document.getElementById('noResults');
    const pagination = document.getElementById('pagination');
    
    console.log('üé® Mostrando noticias...');
    console.log('  - Noticias filtradas:', filteredNews.length);
    
    newsList.innerHTML = '';
    
    if (filteredNews.length === 0) {
      noResults.classList.remove('hidden');
      pagination.classList.add('hidden');
      newsList.style.display = 'none';
      return;
    }
    
    noResults.classList.add('hidden');
    newsList.style.display = 'grid';
    
    // Calcular paginaci√≥n
    const start = (currentPage - 1) * itemsPerPage;
    const end = start + itemsPerPage;
    const pageNews = filteredNews.slice(start, end);
    
    console.log(`  - Mostrando desde ${start} hasta ${end}`);
    console.log(`  - Total en esta p√°gina: ${pageNews.length}`);
    
    // Crear cards
    pageNews.forEach((news, index) => {
      console.log(`\nüìÑ Creando card ${index + 1}:`);
      console.log('  ID:', news.id);
      console.log('  T√≠tulo:', news.title);
      console.log('  Descripci√≥n:', news.description?.substring(0, 50) + '...');
      
      const card = document.createElement('article');
      card.className = 'card';
      
      // Validar campos
      const title = news.title || 'Sin t√≠tulo';
      const description = news.description || 'Sin descripci√≥n';
      const link = news.link || '#';
      const image = news.image;
      
      const date = new Date(news.date).toLocaleDateString('es-ES', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
      
      console.log('  Fecha formateada:', date);
      
      // Construir HTML
      let cardHTML = '';
      
      // Imagen
      if (image && image !== 'null' && image !== null) {
        const imageUrl = image.startsWith('http') 
        ? image 
        : `${window.location.origin}${image}`;
        console.log('  üñºÔ∏è Imagen:', imageUrl);
        cardHTML += `<img src="${imageUrl}" alt="${title}" style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px 8px 0 0; margin: -30px -30px 15px -30px;" onerror="console.error('Error cargando:', this.src); this.style.display='none'">`;
      }
      
      // Contenido
      cardHTML += `
      <h3 style="color: #003366; margin-bottom: 10px; font-size: 20px; font-weight: 600;">${title}</h3>
      <span class="date" style="display: block; font-size: 13px; color: #777; margin-bottom: 10px; font-style: italic;">${date}</span>
      <p style="color: #555; line-height: 1.6; margin-bottom: 15px;">${description.length > 150 ? description.substring(0, 150) + '...' : description}</p>
      `;
      
      // Link
      if (link && link !== '#' && link !== 'null') {
        cardHTML += `<a href="${link}" class="read-more" style="color: #003366; font-weight: 600; display: inline-block; margin-top: 10px; text-decoration: none;" target="_blank">Leer m√°s ‚Üí</a>`;
      }
      
      card.innerHTML = cardHTML;
      console.log('  ‚úÖ Card creada');
      
      newsList.appendChild(card);
    });
    
    console.log('\n‚úÖ Total cards en DOM:', newsList.children.length);
    
    // Mostrar paginaci√≥n
    renderPagination();
  }
  
  // Renderizar paginaci√≥n
  function renderPagination() {
    const pagination = document.getElementById('pagination');
    const totalPages = Math.ceil(filteredNews.length / itemsPerPage);
    
    if (totalPages <= 1) {
      pagination.classList.add('hidden');
      return;
    }
    
    pagination.classList.remove('hidden');
    pagination.innerHTML = '';
    
    // Bot√≥n anterior
    const prevBtn = document.createElement('button');
    prevBtn.textContent = '‚Üê Anterior';
    prevBtn.disabled = currentPage === 1;
    prevBtn.onclick = () => {
      currentPage--;
      displayNews();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    };
    pagination.appendChild(prevBtn);
    
    // N√∫meros de p√°gina
    for (let i = 1; i <= totalPages; i++) {
      const pageBtn = document.createElement('button');
      pageBtn.textContent = i;
      pageBtn.className = i === currentPage ? 'active' : '';
      pageBtn.onclick = () => {
        currentPage = i;
        displayNews();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      };
      pagination.appendChild(pageBtn);
    }
    
    // Bot√≥n siguiente
    const nextBtn = document.createElement('button');
    nextBtn.textContent = 'Siguiente ‚Üí';
    nextBtn.disabled = currentPage === totalPages;
    nextBtn.onclick = () => {
      currentPage++;
      displayNews();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    };
    pagination.appendChild(nextBtn);
  }
  
  // B√∫squeda
  const searchBox = document.getElementById('searchBox');
  let searchTimeout;
  
  searchBox.addEventListener('input', (e) => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
      const query = e.target.value.toLowerCase().trim();
      
      console.log('üîç Buscando:', query);
      
      if (query === '') {
        filteredNews = allNews;
      } else {
        filteredNews = allNews.filter(news => 
        (news.title && news.title.toLowerCase().includes(query)) || 
        (news.description && news.description.toLowerCase().includes(query))
      );
    }
    
    console.log('üìä Resultados:', filteredNews.length);
    
    currentPage = 1;
    displayNews();
  }, 300);
});

// Cargar al iniciar
console.log('üöÄ Iniciando carga de noticias...'+ loadNews);
loadNews();
});
</script>
</body>
</html>